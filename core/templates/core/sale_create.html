{% extends "inventory/base.html" %}
{% block title %}New Sale{% endblock %}
{% block content %}
<h2>New Sale</h2>

<form method="post" class="row g-3 mb-3">
  {% csrf_token %}
  <div class="col-md-4">
    {{ form.barcode.label_tag }} {{ form.barcode }}
  </div>
  <div class="col-md-4">
    {{ form.product.label_tag }} {{ form.product }}
  </div>
  <div class="col-md-2">
    {{ form.quantity.label_tag }} {{ form.quantity }}
  </div>
  <div class="col-md-2 d-flex align-items-end">
    <button type="submit" name="add_item" class="btn btn-primary w-100">Add Item</button>
  </div>
</form>

<h4>Cart</h4>
<table class="table table-bordered">
  <thead>
    <tr>
      <th>Product</th>
      <th>Price</th>
      <th>Quantity</th>
      <th>Line Total</th>
    </tr>
  </thead>
  <tbody>
    {% for item in cart.values %}
    <tr>
      <td>{{ item.name }}</td>
      <td>{{ item.price }}</td>
      <td>{{ item.quantity }}</td>
      <td>{{ item.price|floatformat:2|add:""|floatformat:2 }}</td>
    </tr>
    {% empty %}
    <tr><td colspan="4" class="text-center">Cart is empty.</td></tr>
    {% endfor %}
  </tbody>
</table>

<div class="d-flex justify-content-between">
  <h5>Total: {{ cart_total }}</h5>
</div>

<form method="post" class="mt-3">
  {% csrf_token %}
  <div class="row">
    <div class="col-md-6">
      <label for="customer_name" class="form-label">Customer Name (optional)</label>
      <input type="text" name="customer_name" id="customer_name" class="form-control">
    </div>
    <div class="col-md-6 d-flex align-items-end">
      <button type="submit" name="checkout" class="btn btn-success w-100">Checkout and Save Sale</button>
    </div>
  </div>
</form>
{% endblock %}